var EscapeDelims = require('escape-delims');

var utils = exports;

// regex for identifying on-- escaping
var onEventPattern = /on-(?!-)/g;
var escapedOn = 'on--';
var unescapedOn = 'on-';
var onEventEscapedPattern = /on--/g;

utils.escapeOnEvents = function (templateHtml) {
    var escaped = templateHtml.replace(onEventPattern, escapedOn);
    return escaped;
};

utils.unescapeOnEvents = function (templateHtml) {
    var unescaped = templateHtml.replace(onEventEscapedPattern, unescapedOn);
    return unescaped;
};

utils.DEFAULT_DELIMS = ['{{', '}}'];
escaperCache = {};

utils.escapeDelims = function (templateHtml, delims) {
    var delims = delims || utils.DEFAULT_DELIMS;
    var delimsKey = delims.join(' ');
    var escaper = escaperCache[delimsKey] ? escaperCache[delimsKey] : new EscapeDelims(delims);
    escaperCache[delimsKey] = escaper;
    return escaper.escape(templateHtml);
};

utils.unescapeDelims = function (templateHtml, delims) {
    var delims = delims || utils.DEFAULT_DELIMS;
    var delimsKey = delims.join(' ');
    var escaper = escaperCache[delimsKey] ? escaperCache[delimsKey] : new EscapeDelims(delims);
    escaperCache[delimsKey] = escaper;
    return escaper.unescape(templateHtml);
};
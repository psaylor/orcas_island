/*
    * Promisify access to getUserMedia
    * borrowed from https://github.com/janlelis/promiseUserMedia.js/blob/master/promiseUserMedia.js under MIT license
    */

/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */

// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// "Software"), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.

define("crossBrowserAudio",["promise","modernizr"],function(e,t){window.AudioContext=t.prefixed("AudioContext",window),navigator.getUserMedia=t.prefixed("getUserMedia",navigator);var n=window.AudioContext;console.log("AudioContext set up",n),navigator.getUserMedia||(console.err("Browser does not support getUserMedia"),alert("Browser does not support getUserMedia")),console.log("defining crossBrowserAudio");var r=function i(t){return new e(function(n,r){if(!i.isAvailable){var s=new Error("getUserMedia is not supported");s.name="MediaNotSupportedError",r(s)}else i.getUserMedia.call(navigator,t,n,r)})};return r.getUserMedia=navigator.getUserMedia,r.isAvailable=!!r.getUserMedia,{AudioContext:n,getUserMedia:navigator.getUserMedia,promiseUserMedia:r}}),define("sharedAudio",["jquery","crossBrowserAudio","promise"],function(e,t,n){var r=new t.AudioContext,i={audio:!0,video:!1},s=t.promiseUserMedia(i).then(function(t){console.log("SharedAudio got localmediastream",typeof t);var n=r.createMediaStreamSource(t);return console.log("Created audio stream",typeof n),n}).error(function(t){alert("getUserMedia: "+t.name+"\n"+t.message),console.log("Media access rejected.",t)}),o=function(t){return new n(function(n,i){r.decodeAudioData.call(r,t,n,i)})},u=function(t){return new n(function(n,i){var s=r.createBufferSource();s.buffer=t,s.connect(r.destination),s.start(),s.onended=n})},a={audioContext:r,audioStreamPromise:s,promiseDecodeAudioData:o,promisePlayAudioData:u};return a}),define("utils",["jquery"],function(e){var t={},n=/[.,?!";:@#$%^&*()]/g;return t.normalizeString=function(e){var t=e.replace(n,"");return t=t.toLowerCase(),t},t.average=function(e,t,n){var r=0,t=t||0,n=n||e.length;for(var i=t;i<n;i++)r+=e[i];return r/(n-t)},t.convertFloat32ToInt16=function(e){var t=e.length,n=new Int16Array(t);while(t--)n[t]=Math.min(1,e[t])*32767;return n.buffer},t.addGlobalVariable=function(e,t){window.GLOB?window.GLOB[e]=t:(window.GLOB={},window.GLOB[e]=t)},t.noOp=function(){},t}),define("microphone",["jquery","sharedAudio","utils"],function(e,t,n){console.log("> Loading microphone.js");var r=t.audioContext,i=r.sampleRate,s=function(t,n){if(!(this instanceof s))return new s(t,n);n=n||{},this.settings=e.extend({},s.DEFAULTS,n),this.$this=e(this),this.element=e(t),this.adjustable=this.element.find(".vol-adjust"),this.autoAdjust=this.settings.autoAdjust,this.adjustableHeight=this.settings.maxMeterHeight-this.settings.minMeterHeight,this.minFreqIndex=this._getFrequencyIndex(this.settings.minFrequency),this.maxFreqIndex=this._getFrequencyIndex(this.settings.maxFrequency),this._setupMeterElement(),this._setupAudioNodes()};return s.DEFAULTS={analyserFftSize:128,smoothingTimeConstant:.5,scriptBufferSize:2048,numInputChannels:1,numOutputChannels:1,autoAdjust:!0,selectable:!0,minMeterHeight:35,maxMeterHeight:100,minFrequency:300,maxFrequency:3300},s.prototype._setupAudioNodes=function(){var e=this;this.analyser=r.createAnalyser(),this.analyser.smoothingTimeConstant=this.settings.smoothingTimeConstant,this.analyser.fftSize=this.settings.analyserFftSize,this.javascriptNode=r.createScriptProcessor(this.settings.scriptBufferSize,this.settings.numInputChannels,this.settings.numOutputChannels),this.javascriptNode.connect(r.destination),this.javascriptNode.onaudioprocess=function(){e._onaudioprocess.call(e)},n.addGlobalVariable("spokeJavascriptNode",this.javascriptNode),console.log("Created analyser node:",typeof this.analyser,this.analyser),console.log("Created script processor node:",typeof this.javascriptNode,this.javascriptNode),t.audioStreamPromise.then(function(t){return console.log("Microphone icon got access to audioStreamSource",typeof t,t),t.connect(e.analyser),e.analyser.connect(e.javascriptNode),e.javascriptNode.connect(r.destination),t}).catch(function(e){console.log("Audio streaming error in microphone:",e)})},s.prototype._setupMeterElement=function(){this.settings.selectable||this.element.addClass("glyph")},s.prototype._onaudioprocess=function(){var e=new Uint8Array(this.analyser.frequencyBinCount);this.analyser.getByteFrequencyData(e);var t=this._computeVolumeLevel(e);this.$this.trigger("volumeLevel.spoke.volumeMeter",[t]),this.autoAdjust&&this.adjustVolumeMeter(t)},s.prototype._getFrequencyIndex=function(e){var t=Math.floor(e*this.settings.analyserFftSize/i);return t},s.prototype._computeMeterHeight=function(e){var t=e*this.adjustableHeight+this.settings.minMeterHeight;t=t.toFixed();var n=this.settings.maxMeterHeight-Math.min(t,this.settings.maxMeterHeight);return n},s.prototype._computeVolumeLevel=function(e){var t=n.average(e,this.minFreqIndex,this.maxFreqIndex),r=t/256;return r},s.prototype.adjustVolumeMeter=function(e){var t=this._computeMeterHeight(e);this.adjustable.css("max-height",t+"%")},s.prototype.on=function(e,t){this.$this.on(e,t)},{VolumeMeter:s}}),define("player",["jquery","sharedAudio","promise"],function(e,t,n){console.log("> Loading player.js");var r=t.audioContext,i=function(t,n){if(!(this instanceof i))return new i(t,n);console.log("Creating new Player for stream",t),n=n||{},this.settings=e.extend({},i.DEFAULTS,n),this.$this=e(this),this.audioStream=t,this.audioDataArray=[],this.audioDataBuffer=null,this._listenToAudioStream()};return i.DEFAULTS={autoPlay:!0},i.prototype._listenToAudioStream=function(){var e=this;this.audioStream.on("data",function(t){e._onAudioData(t)}),this.audioStream.on("end",function(){e._onAudioEnd()})},i.prototype._onAudioData=function(e){this.audioDataArray.push(e)},i.prototype._onAudioEnd=function(){var e=0;for(var t=0;t<this.audioDataArray.length;t++)e+=this.audioDataArray[t].byteLength;this.audioDataBuffer=new Uint8Array(e);var n=0;for(var r=0;r<this.audioDataArray.length;r++){var i=new Uint8Array(this.audioDataArray[r]);this.audioDataBuffer.set(i,n),n+=i.byteLength}this.$this.trigger("ready.spoke.player"),this.settings.autoPlay&&this.playAudio()},i.prototype.playAudio=function(){var e=this;t.promiseDecodeAudioData(this.audioDataBuffer.buffer).then(t.promisePlayAudioData).then(function(){e.$this.trigger("done.spoke.player")})},i.prototype.on=function(e,t){this.$this.on(e,t)},i}),function(e){if(typeof exports=="object"&&typeof module!="undefined")module.exports=e();else if(typeof define=="function"&&define.amd)define("socketio-stream",[],e);else{var t;typeof window!="undefined"?t=window:typeof global!="undefined"?t=global:typeof self!="undefined"?t=self:t=this,t.ss=e()}}(function(){var e,t,n;return function r(e,t,n){function i(o,u){if(!t[o]){if(!e[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(s)return s(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=t[o]={exports:{}};e[o][0].call(l.exports,function(t){var n=e[o][1][t];return i(n?n:t)},l,l.exports,r,e,t,n)}return t[o].exports}var s=typeof require=="function"&&require;for(var o=0;o<n.length;o++)i(n[o]);return i}({1:[function(e,t,n){function i(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function s(){var e=arguments,t=this.useColors;e[0]=(t?"%c":"")+this.namespace+(t?" %c":" ")+e[0]+(t?"%c ":" ")+"+"+n.humanize(this.diff);if(!t)return e;var r="color: "+this.color;e=[e[0],r,"color: inherit"].concat(Array.prototype.slice.call(e,1));var i=0,s=0;return e[0].replace(/%[a-z%]/g,function(e){if("%%"===e)return;i++,"%c"===e&&(s=i)}),e.splice(s,0,r),e}function o(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function u(e){try{null==e?r.removeItem("debug"):r.debug=e}catch(t){}}function a(){var e;try{e=r.debug}catch(t){}return e}function f(){try{return window.localStorage}catch(e){}}n=t.exports=e("./debug"),n.log=o,n.formatArgs=s,n.save=u,n.load=a,n.useColors=i;var r;typeof chrome!="undefined"&&typeof chrome.storage!="undefined"?r=chrome.storage.local:r=f(),n.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],n.formatters.j=function(e){return JSON.stringify(e)},n.enable(a())},{"./debug":2}],2:[function(e,t,n){function s(){return n.colors[r++%n.colors.length]}function o(e){function t(){}function r(){var e=r,t=+(new Date),o=t-(i||t);e.diff=o,e.prev=i,e.curr=t,i=t,null==e.useColors&&(e.useColors=n.useColors()),null==e.color&&e.useColors&&(e.color=s());var u=Array.prototype.slice.call(arguments);u[0]=n.coerce(u[0]),"string"!=typeof u[0]&&(u=["%o"].concat(u));var a=0;u[0]=u[0].replace(/%([a-z%])/g,function(t,r){if(t==="%%")return t;a++;var i=n.formatters[r];if("function"==typeof i){var s=u[a];t=i.call(e,s),u.splice(a,1),a--}return t}),"function"==typeof n.formatArgs&&(u=n.formatArgs.apply(e,u));var f=r.log||n.log||console.log.bind(console);f.apply(e,u)}t.enabled=!1,r.enabled=!0;var o=n.enabled(e)?r:t;return o.namespace=e,o}function u(e){n.save(e);var t=(e||"").split(/[\s,]+/),r=t.length;for(var i=0;i<r;i++){if(!t[i])continue;e=t[i].replace(/\*/g,".*?"),e[0]==="-"?n.skips.push(new RegExp("^"+e.substr(1)+"$")):n.names.push(new RegExp("^"+e+"$"))}}function a(){n.enable("")}function f(e){var t,r;for(t=0,r=n.skips.length;t<r;t++)if(n.skips[t].test(e))return!1;for(t=0,r=n.names.length;t<r;t++)if(n.names[t].test(e))return!0;return!1}function l(e){return e instanceof Error?e.stack||e.message:e}n=t.exports=o,n.coerce=l,n.disable=a,n.enable=u,n.enabled=f,n.humanize=e("ms"),n.names=[],n.skips=[],n.formatters={};var r=0,i},{ms:3}],3:[function(e,t,n){function a(e){var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!t)return;var n=parseFloat(t[1]),a=(t[2]||"ms").toLowerCase();switch(a){case"years":case"year":case"yrs":case"yr":case"y":return n*u;case"days":case"day":case"d":return n*o;case"hours":case"hour":case"hrs":case"hr":case"h":return n*s;case"minutes":case"minute":case"mins":case"min":case"m":return n*i;case"seconds":case"second":case"secs":case"sec":case"s":return n*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n}}function f(e){return e>=o?Math.round(e/o)+"d":e>=s?Math.round(e/s)+"h":e>=i?Math.round(e/i)+"m":e>=r?Math.round(e/r)+"s":e+"ms"}function l(e){return c(e,o,"day")||c(e,s,"hour")||c(e,i,"minute")||c(e,r,"second")||e+" ms"}function c(e,t,n){if(e<t)return;return e<t*1.5?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}var r=1e3,i=r*60,s=i*60,o=s*24,u=o*365.25;t.exports=function(e,t){return t=t||{},"string"==typeof e?a(e):t.long?l(e):f(e)}},{}],4:[function(e,t,n){t.exports=e("./lib")},{"./lib":6}],5:[function(e,t,n){(function(n){function o(e,t){if(!(this instanceof o))return new o(e,t);i.call(this,t),this.blob=e,this.slice=e.slice||e.webkitSlice||e.mozSlice,this.start=0;var n=this.fileReader=new FileReader;n.onload=s(this,"_onload"),n.onerror=s(this,"_onerror")}var r=e("util"),i=e("stream").Readable,s=e("component-bind");t.exports=o,r.inherits(o,i),o.prototype._read=function(e){var t=this.start,n=this.start=this.start+e,r=this.slice.call(this.blob,t,n);r.size?this.fileReader.readAsArrayBuffer(r):this.push(null)},o.prototype._onload=function(e){var t=new n(new Uint8Array(e.target.result));this.push(t)},o.prototype._onerror=function(e){var t=e.target.error;this.emit("error",t)}}).call(this,e("buffer").Buffer)},{buffer:12,"component-bind":10,stream:31,util:34}],6:[function(e,t,n){function o(e,t){return t=t||{},null==t.forceBase64&&(t.forceBase64=n.forceBase64),e._streamSocket||(e._streamSocket=new r(e,t)),e._streamSocket}var r=e("./socket"),i=e("./iostream"),s=e("./blob-read-stream");n=t.exports=o,n.Socket=r,n.forceBase64=!1,n.createStream=function(e){return new i(e)},n.createBlobReadStream=function(e,t){return new s(e,t)}},{"./blob-read-stream":5,"./iostream":7,"./socket":8}],7:[function(e,t,n){(function(n){function u(e){if(!(this instanceof u))return new u(e);u.super_.call(this,e),this.id=null,this.socket=null,this.pushBuffer=[],this.writeBuffer=[],this._readable=!1,this._writable=!1,this.destroyed=!1,this.allowHalfOpen=e&&e.allowHalfOpen||!1,this.on("finish",this._onfinish),this.on("end",this._onend),this.on("error",this._onerror)}var r=e("util"),i=e("stream").Duplex,s=e("component-bind"),o=e("debug")("socket.io-stream:iostream");t.exports=u,r.inherits(u,i),u.prototype.writeAudio=function(e){this.write(new n(new Uint8Array(e)))},u.prototype.destroy=function(){o("destroy");if(this.destroyed){o("already destroyed");return}this.readable=this.writable=!1,this.socket&&(o("clean up"),this.socket.cleanup(this.id),this.socket=null),this.destroyed=!0},u.prototype._read=function(e){var t;if(this.destroyed)return;if(this.pushBuffer.length){while(t=this.pushBuffer.shift())if(!t())break;return}this._readable=!0,this.socket._read(this.id,e)},u.prototype._onread=function(e){var t=this.writeBuffer.shift();if(t)return t();this._writable=!0},u.prototype._write=function(e,t,n){function i(){if(r.destroyed)return;r._writable=!1,r.socket._write(r.id,e,t,n)}var r=this;this._writable?i():this.writeBuffer.push(i)},u.prototype._onwrite=function(e,t,n){function i(){r._readable=!1;var i=r.push(e||"",t);return n(),i}var r=this;this._readable?i():this.pushBuffer.push(i)},u.prototype._end=function(){this.pushBuffer.length?this.pushBuffer.push(s(this,"_done")):this._done()},u.prototype._done=function(){return this._readable=!1,this.push(null)},u.prototype._onfinish=function(){o("_onfinish"),this.socket&&this.socket._end(this.id),this.writable=!1,this._writableState.ended=!0;if(!this.readable||this._readableState.ended)return o("_onfinish: ended, destroy %s",this._readableState),this.destroy();o("_onfinish: not ended"),this.allowHalfOpen||(this.push(null),this.readable&&!this._readableState.endEmitted&&this.read(0))},u.prototype._onend=function(){o("_onend"),this.readable=!1,this._readableState.ended=!0;if(!this.writable||this._writableState.finished)return o("_onend: %s",this._writableState),this.destroy();o("_onend: not finished"),this.allowHalfOpen||this.end()},u.prototype._onerror=function(e){!e.remote&&this.socket&&this.socket._error(this.id,e),this.destroy()}}).call(this,e("buffer").Buffer)},{buffer:12,"component-bind":10,debug:1,stream:31,util:34}],8:[function(e,t,n){(function(r,i){function d(e,t){if(!(this instanceof d))return new d(e,t);o.call(this),t=t||{},this.sio=e,this.forceBase64=!!t.forceBase64,this.streams={};var r=n.event;e.on(r,f(this,c)),e.on(r+"-read",f(this,"_onread")),e.on(r+"-write",f(this,"_onwrite")),e.on(r+"-end",f(this,"_onend")),e.on(r+"-error",f(this,"_onerror")),e.on("error",f(this,c,"error")),e.on("disconnect",f(this,"_ondisconnect"))}var s=e("util"),o=e("events").EventEmitter,u=e("./iostream"),a=e("./uuid"),f=e("component-bind"),l=e("debug")("socket.io-stream:socket"),c=o.prototype.emit,h=o.prototype.on,p=Array.prototype.slice;n=t.exports=d,n.event="$stream",n.events=["error","newListener","removeListener"],s.inherits(d,o),d.prototype.$emit=c,d.prototype.emit=function(e){return~n.events.indexOf(e)?c.apply(this,arguments):(this._stream.apply(this,arguments),this)},d.prototype.on=function(e,t,r){return~n.events.indexOf(e)?h.apply(this,arguments):("function"==typeof t&&(r=t,t=null),this._onstream(e,t,r),this)},d.prototype._stream=function(e){l("sending new streams");var t=p.call(arguments,1),r=[],i=this.sio;t=t.map(function(e,t){if(e instanceof u){if(e.socket||e.destroyed)throw new Error("stream has already been sent.");r.push(t);var n=a();return this.streams[n]=e,e.id=n,e.socket=this,n}return e},this),i.emit.apply(i,[n.event,e,r].concat(t))},d.prototype._read=function(e,t){this.sio.emit(n.event+"-read",e,t)},d.prototype._write=function(e,t,s,o){this.forceBase64?(s="base64",t=t.toString(s)):i.isBuffer(t)&&!r.Buffer&&(t=t.toArrayBuffer()),this.sio.emit(n.event+"-write",e,t,s,o)},d.prototype._end=function(e){this.sio.emit(n.event+"-end",e)},d.prototype._error=function(e,t){this.sio.emit(n.event+"-error",e,t.message||t)},d.prototype._onstream=function(e,t,n){function r(e){l("new streams");var r=p.call(arguments,1);r=r.map(function(n,r){if(!~e.indexOf(r))return n;if(this.streams[n]){this._error(n,"id already exists");return}var i=this.streams[n]=new u(t);return i.id=n,i.socket=this,i},this),n.apply(this,r)}if("function"!=typeof n)throw TypeError("listener must be a function");r.listener=n,h.call(this,e,r)},d.prototype._onread=function(e,t){l('read: "%s"',e);var n=this.streams[e];n?n._onread(t):this._error(e,"invalid stream id")},d.prototype._onwrite=function(e,t,n,s){l('write: "%s"',e);var o=this.streams[e];if(!o){this._error(e,"invalid stream id");return}r.ArrayBuffer&&t instanceof ArrayBuffer&&(t=new i(new Uint8Array(t))),o._onwrite(t,n,s)},d.prototype._onend=function(e){l('end: "%s"',e);var t=this.streams[e];if(!t){this._error(e,"invalid stream id");return}t._end()},d.prototype._onerror=function(e,t){l('error: "%s", "%s"',e,t);var n=this.streams[e];if(!n){l('invalid stream id: "%s"',e);return}var r=new Error(t);r.remote=!0,n.emit("error",r)},d.prototype._ondisconnect=function(){var e;for(var t in this.streams)e=this.streams[t],e.destroy(),e.emit("close"),e.emit("error",new Error("Connection aborted"))},d.prototype.cleanup=function(e){delete this.streams[e]}}).call(this,typeof global!="undefined"?global:typeof self!="undefined"?self:typeof window!="undefined"?window:{},e("buffer").Buffer)},{"./iostream":7,"./uuid":9,buffer:12,"component-bind":10,debug:1,events:16,util:34}],9:[function(e,t,n){function r(e){return e?(e^Math.random()*16>>e/4).toString(16):([1e7]+ -1e3+ -4e3+ -8e3+ -1e11).replace(/[018]/g,r)}t.exports=r},{}],10:[function(e,t,n){var r=[].slice;t.exports=function(e,t){"string"==typeof t&&(t=e[t]);if("function"!=typeof t)throw new Error("bind() requires a function");var n=r.call(arguments,2);return function(){return t.apply(e,n.concat(r.call(arguments)))}}},{}],11:[function(e,t,n){},{}],12:[function(e,t,n){function a(e,t){var n=this;if(n instanceof a){var r=typeof e,i;if(r==="number")i=+e;else if(r==="string")i=a.byteLength(e,t);else{if(r!=="object"||e===null)throw new TypeError("must start with number, buffer, array or string");e.type==="Buffer"&&s(e.data)&&(e=e.data),i=+e.length}if(i>o)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");i<0?i=0:i>>>=0,a.TYPED_ARRAY_SUPPORT?n=a._augment(new Uint8Array(i)):(n.length=i,n._isBuffer=!0);var f;if(a.TYPED_ARRAY_SUPPORT&&typeof e.byteLength=="number")n._set(e);else if(D(e))if(a.isBuffer(e))for(f=0;f<i;f++)n[f]=e.readUInt8(f);else for(f=0;f<i;f++)n[f]=(e[f]%256+256)%256;else if(r==="string")n.write(e,0,t);else if(r==="number"&&!a.TYPED_ARRAY_SUPPORT)for(f=0;f<i;f++)n[f]=0;return i>0&&i<=a.poolSize&&(n.parent=u),n}return new a(e,t)}function f(e,t){if(this instanceof f){var n=new a(e,t);return delete n.parent,n}return new f(e,t)}function l(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r),r>i&&(r=i)):r=i;var s=t.length;if(s%2!==0)throw new Error("Invalid hex string");r>s/2&&(r=s/2);for(var o=0;o<r;o++){var u=parseInt(t.substr(o*2,2),16);if(isNaN(u))throw new Error("Invalid hex string");e[n+o]=u}return o}function c(e,t,n,r){var i=I(H(t,e.length-n),e,n,r);return i}function h(e,t,n,r){var i=I(B(t),e,n,r);return i}function p(e,t,n,r){return h(e,t,n,r)}function d(e,t,n,r){var i=I(F(t),e,n,r);return i}function v(e,t,n,r){var i=I(j(t,e.length-n),e,n,r);return i}function m(e,t,n){return t===0&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function g(e,t,n){var r="",i="";n=Math.min(e.length,n);for(var s=t;s<n;s++)e[s]<=127?(r+=q(i)+String.fromCharCode(e[s]),i=""):i+="%"+e[s].toString(16);return r+q(i)}function y(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;i++)r+=String.fromCharCode(e[i]&127);return r}function b(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;i++)r+=String.fromCharCode(e[i]);return r}function w(e,t,n){var r=e.length;if(!t||t<0)t=0;if(!n||n<0||n>r)n=r;var i="";for(var s=t;s<n;s++)i+=P(e[s]);return i}function E(e,t,n){var r=e.slice(t,n),i="";for(var s=0;s<r.length;s+=2)i+=String.fromCharCode(r[s]+r[s+1]*256);return i}function S(e,t,n){if(e%1!==0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function x(e,t,n,r,i,s){if(!a.isBuffer(e))throw new TypeError("buffer must be a Buffer instance");if(t>i||t<s)throw new RangeError("value is out of bounds");if(n+r>e.length)throw new RangeError("index out of range")}function T(e,t,n,r){t<0&&(t=65535+t+1);for(var i=0,s=Math.min(e.length-n,2);i<s;i++)e[n+i]=(t&255<<8*(r?i:1-i))>>>(r?i:1-i)*8}function N(e,t,n,r){t<0&&(t=4294967295+t+1);for(var i=0,s=Math.min(e.length-n,4);i<s;i++)e[n+i]=t>>>(r?i:3-i)*8&255}function C(e,t,n,r,i,s){if(t>i||t<s)throw new RangeError("value is out of bounds");if(n+r>e.length)throw new RangeError("index out of range");if(n<0)throw new RangeError("index out of range")}function k(e,t,n,r,s){return s||C(e,t,n,4,3.4028234663852886e38,-3.4028234663852886e38),i.write(e,t,n,r,23,4),n+4}function L(e,t,n,r,s){return s||C(e,t,n,8,1.7976931348623157e308,-1.7976931348623157e308),i.write(e,t,n,r,52,8),n+8}function M(e){e=_(e).replace(O,"");if(e.length<2)return"";while(e.length%4!==0)e+="=";return e}function _(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function D(e){return s(e)||a.isBuffer(e)||e&&typeof e=="object"&&typeof e.length=="number"}function P(e){return e<16?"0"+e.toString(16):e.toString(16)}function H(e,t){t=t||Infinity;var n,r=e.length,i=null,s=[],o=0;for(;o<r;o++){n=e.charCodeAt(o);if(n>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&s.push(239,191,189);continue}if(o+1===r){(t-=3)>-1&&s.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&s.push(239,191,189),i=n;continue}n=i-55296<<10|n-56320|65536,i=null}else i&&((t-=3)>-1&&s.push(239,191,189),i=null);if(n<128){if((t-=1)<0)break;s.push(n)}else if(n<2048){if((t-=2)<0)break;s.push(n>>6|192,n&63|128)}else if(n<65536){if((t-=3)<0)break;s.push(n>>12|224,n>>6&63|128,n&63|128)}else{if(!(n<2097152))throw new Error("Invalid code point");if((t-=4)<0)break;s.push(n>>18|240,n>>12&63|128,n>>6&63|128,n&63|128)}}return s}function B(e){var t=[];for(var n=0;n<e.length;n++)t.push(e.charCodeAt(n)&255);return t}function j(e,t){var n,r,i,s=[];for(var o=0;o<e.length;o++){if((t-=2)<0)break;n=e.charCodeAt(o),r=n>>8,i=n%256,s.push(i),s.push(r)}return s}function F(e){return r.toByteArray(M(e))}function I(e,t,n,r){for(var i=0;i<r;i++){if(i+n>=t.length||i>=e.length)break;t[i+n]=e[i]}return i}function q(e){try{return decodeURIComponent(e)}catch(t){return String.fromCharCode(65533)}}var r=e("base64-js"),i=e("ieee754"),s=e("is-array");n.Buffer=a,n.SlowBuffer=f,n.INSPECT_MAX_BYTES=50,a.poolSize=8192;var o=1073741823,u={};a.TYPED_ARRAY_SUPPORT=function(){try{var e=new ArrayBuffer(0),t=new Uint8Array(e);return t.foo=function(){return 42},t.foo()===42&&typeof t.subarray=="function"&&(new Uint8Array(1)).subarray(1,1).byteLength===0}catch(n){return!1}}(),a.isBuffer=function(t){return t!=null&&!!t._isBuffer},a.compare=function(t,n){if(!a.isBuffer(t)||!a.isBuffer(n))throw new TypeError("Arguments must be Buffers");if(t===n)return 0;var r=t.length,i=n.length;for(var s=0,o=Math.min(r,i);s<o&&t[s]===n[s];s++);return s!==o&&(r=t[s],i=n[s]),r<i?-1:i<r?1:0},a.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(t,n){if(!s(t))throw new TypeError("list argument must be an Array of Buffers.");if(t.length===0)return new a(0);if(t.length===1)return t[0];var r;if(n===undefined){n=0;for(r=0;r<t.length;r++)n+=t[r].length}var i=new a(n),o=0;for(r=0;r<t.length;r++){var u=t[r];u.copy(i,o),o+=u.length}return i},a.byteLength=function(t,n){var r;t+="";switch(n||"utf8"){case"ascii":case"binary":case"raw":r=t.length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":r=t.length*2;break;case"hex":r=t.length>>>1;break;case"utf8":case"utf-8":r=H(t).length;break;case"base64":r=F(t).length;break;default:r=t.length}return r},a.prototype.length=undefined,a.prototype.parent=undefined,a.prototype.toString=function R(e,t,n){var r=!1;t>>>=0,n=n===undefined||n===Infinity?this.length:n>>>0,e||(e="utf8"),t<0&&(t=0),n>this.length&&(n=this.length);if(n<=t)return"";for(;;)switch(e){case"hex":return w(this,t,n);case"utf8":case"utf-8":return g(this,t,n);case"ascii":return y(this,t,n);case"binary":return b(this,t,n);case"base64":return m(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return E(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}},a.prototype.equals=function(t){if(!a.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t?!0:a.compare(this,t)===0},a.prototype.inspect=function(){var t="",r=n.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(t+=" ... ")),"<Buffer "+t+">"},a.prototype.compare=function(t){if(!a.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t?0:a.compare(this,t)},a.prototype.indexOf=function(t,n){function r(e,t,n){var r=-1;for(var i=0;n+i<e.length;i++)if(e[n+i]===t[r===-1?0:i-r]){r===-1&&(r=i);if(i-r+1===t.length)return n+r}else r=-1;return-1}n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n>>=0;if(this.length===0)return-1;if(n>=this.length)return-1;n<0&&(n=Math.max(this.length+n,0));if(typeof t=="string")return t.length===0?-1:String.prototype.indexOf.call(this,t,n);if(a.isBuffer(t))return r(this,t,n);if(typeof t=="number")return a.TYPED_ARRAY_SUPPORT&&Uint8Array.prototype.indexOf==="function"?Uint8Array.prototype.indexOf.call(this,t,n):r(this,[t],n);throw new TypeError("val must be string, number or Buffer")},a.prototype.get=function(t){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(t)},a.prototype.set=function(t,n){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(t,n)},a.prototype.write=function(t,n,r,i){if(isFinite(n))isFinite(r)||(i=r,r=undefined);else{var s=i;i=n,n=r,r=s}n=Number(n)||0;if(r<0||n<0||n>this.length)throw new RangeError("attempt to write outside buffer bounds");var o=this.length-n;r?(r=Number(r),r>o&&(r=o)):r=o,i=String(i||"utf8").toLowerCase();var u;switch(i){case"hex":u=l(this,t,n,r);break;case"utf8":case"utf-8":u=c(this,t,n,r);break;case"ascii":u=h(this,t,n,r);break;case"binary":u=p(this,t,n,r);break;case"base64":u=d(this,t,n,r);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":u=v(this,t,n,r);break;default:throw new TypeError("Unknown encoding: "+i)}return u},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},a.prototype.slice=function(t,n){var r=this.length;t=~~t,n=n===undefined?r:~~n,t<0?(t+=r,t<0&&(t=0)):t>r&&(t=r),n<0?(n+=r,n<0&&(n=0)):n>r&&(n=r),n<t&&(n=t);var i;if(a.TYPED_ARRAY_SUPPORT)i=a._augment(this.subarray(t,n));else{var s=n-t;i=new a(s,undefined);for(var o=0;o<s;o++)i[o]=this[o+t]}return i.length&&(i.parent=this.parent||this),i},a.prototype.readUIntLE=function(t,n,r){t>>>=0,n>>>=0,r||S(t,n,this.length);var i=this[t],s=1,o=0;while(++o<n&&(s*=256))i+=this[t+o]*s;return i},a.prototype.readUIntBE=function(t,n,r){t>>>=0,n>>>=0,r||S(t,n,this.length);var i=this[t+ --n],s=1;while(n>0&&(s*=256))i+=this[t+ --n]*s;return i},a.prototype.readUInt8=function(t,n){return n||S(t,1,this.length),this[t]},a.prototype.readUInt16LE=function(t,n){return n||S(t,2,this.length),this[t]|this[t+1]<<8},a.prototype.readUInt16BE=function(t,n){return n||S(t,2,this.length),this[t]<<8|this[t+1]},a.prototype.readUInt32LE=function(t,n){return n||S(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+this[t+3]*16777216},a.prototype.readUInt32BE=function(t,n){return n||S(t,4,this.length),this[t]*16777216+(this[t+1]<<16|this[t+2]<<8|this[t+3])},a.prototype.readIntLE=function(t,n,r){t>>>=0,n>>>=0,r||S(t,n,this.length);var i=this[t],s=1,o=0;while(++o<n&&(s*=256))i+=this[t+o]*s;return s*=128,i>=s&&(i-=Math.pow(2,8*n)),i},a.prototype.readIntBE=function(t,n,r){t>>>=0,n>>>=0,r||S(t,n,this.length);var i=n,s=1,o=this[t+ --i];while(i>0&&(s*=256))o+=this[t+ --i]*s;return s*=128,o>=s&&(o-=Math.pow(2,8*n)),o},a.prototype.readInt8=function(t,n){return n||S(t,1,this.length),this[t]&128?(255-this[t]+1)*-1:this[t]},a.prototype.readInt16LE=function(t,n){n||S(t,2,this.length);var r=this[t]|this[t+1]<<8;return r&32768?r|4294901760:r},a.prototype.readInt16BE=function(t,n){n||S(t,2,this.length);var r=this[t+1]|this[t]<<8;return r&32768?r|4294901760:r},a.prototype.readInt32LE=function(t,n){return n||S(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},a.prototype.readInt32BE=function(t,n){return n||S(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},a.prototype.readFloatLE=function(t,n){return n||S(t,4,this.length),i.read(this,t,!0,23,4)},a.prototype.readFloatBE=function(t,n){return n||S(t,4,this.length),i.read(this,t,!1,23,4)},a.prototype.readDoubleLE=function(t,n){return n||S(t,8,this.length),i.read(this,t,!0,52,8)},a.prototype.readDoubleBE=function(t,n){return n||S(t,8,this.length),i.read(this,t,!1,52,8)},a.prototype.writeUIntLE=function(t,n,r,i){t=+t,n>>>=0,r>>>=0,i||x(this,t,n,r,Math.pow(2,8*r),0);var s=1,o=0;this[n]=t&255;while(++o<r&&(s*=256))this[n+o]=t/s>>>0&255;return n+r},a.prototype.writeUIntBE=function(t,n,r,i){t=+t,n>>>=0,r>>>=0,i||x(this,t,n,r,Math.pow(2,8*r),0);var s=r-1,o=1;this[n+s]=t&255;while(--s>=0&&(o*=256))this[n+s]=t/o>>>0&255;return n+r},a.prototype.writeUInt8=function(t,n,r){return t=+t,n>>>=0,r||x(this,t,n,1,255,0),a.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[n]=t,n+1},a.prototype.writeUInt16LE=function(t,n,r){return t=+t,n>>>=0,r||x(this,t,n,2,65535,0),a.TYPED_ARRAY_SUPPORT?(this[n]=t,this[n+1]=t>>>8):T(this,t,n,!0),n+2},a.prototype.writeUInt16BE=function(t,n,r){return t=+t,n>>>=0,r||x(this,t,n,2,65535,0),a.TYPED_ARRAY_SUPPORT?(this[n]=t>>>8,this[n+1]=t):T(this,t,n,!1),n+2},a.prototype.writeUInt32LE=function(t,n,r){return t=+t,n>>>=0,r||x(this,t,n,4,4294967295,0),a.TYPED_ARRAY_SUPPORT?(this[n+3]=t>>>24,this[n+2]=t>>>16,this[n+1]=t>>>8,this[n]=t):N(this,t,n,!0),n+4},a.prototype.writeUInt32BE=function(t,n,r){return t=+t,n>>>=0,r||x(this,t,n,4,4294967295,0),a.TYPED_ARRAY_SUPPORT?(this[n]=t>>>24,this[n+1]=t>>>16,this[n+2]=t>>>8,this[n+3]=t):N(this,t,n,!1),n+4},a.prototype.writeIntLE=function(t,n,r,i){t=+t,n>>>=0,i||x(this,t,n,r,Math.pow(2,8*r-1)-1,-Math.pow(2,8*r-1));var s=0,o=1,u=t<0?1:0;this[n]=t&255;while(++s<r&&(o*=256))this[n+s]=(t/o>>0)-u&255;return n+r},a.prototype.writeIntBE=function(t,n,r,i){t=+t,n>>>=0,i||x(this,t,n,r,Math.pow(2,8*r-1)-1,-Math.pow(2,8*r-1));var s=r-1,o=1,u=t<0?1:0;this[n+s]=t&255;while(--s>=0&&(o*=256))this[n+s]=(t/o>>0)-u&255;return n+r},a.prototype.writeInt8=function(t,n,r){return t=+t,n>>>=0,r||x(this,t,n,1,127,-128),a.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[n]=t,n+1},a.prototype.writeInt16LE=function(t,n,r){return t=+t,n>>>=0,r||x(this,t,n,2,32767,-32768),a.TYPED_ARRAY_SUPPORT?(this[n]=t,this[n+1]=t>>>8):T(this,t,n,!0),n+2},a.prototype.writeInt16BE=function(t,n,r){return t=+t,n>>>=0,r||x(this,t,n,2,32767,-32768),a.TYPED_ARRAY_SUPPORT?(this[n]=t>>>8,this[n+1]=t):T(this,t,n,!1),n+2},a.prototype.writeInt32LE=function(t,n,r){return t=+t,n>>>=0,r||x(this,t,n,4,2147483647,-2147483648),a.TYPED_ARRAY_SUPPORT?(this[n]=t,this[n+1]=t>>>8,this[n+2]=t>>>16,this[n+3]=t>>>24):N(this,t,n,!0),n+4},a.prototype.writeInt32BE=function(t,n,r){return t=+t,n>>>=0,r||x(this,t,n,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),a.TYPED_ARRAY_SUPPORT?(this[n]=t>>>24,this[n+1]=t>>>16,this[n+2]=t>>>8,this[n+3]=t):N(this,t,n,!1),n+4},a.prototype.writeFloatLE=function(t,n,r){return k(this,t,n,!0,r)},a.prototype.writeFloatBE=function(t,n,r){return k(this,t,n,!1,r)},a.prototype.writeDoubleLE=function(t,n,r){return L(this,t,n,!0,r)},a.prototype.writeDoubleBE=function(t,n,r){return L(this,t,n,!1,r)},a.prototype.copy=function(t,n,r,i){r||(r=0),!i&&i!==0&&(i=this.length),n>=t.length&&(n=t.length),n||(n=0),i>0&&i<r&&(i=r);if(i===r)return 0;if(t.length===0||this.length===0)return 0;if(n<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),t.length-n<i-r&&(i=t.length-n+r);var s=i-r;if(s<1e3||!a.TYPED_ARRAY_SUPPORT)for(var o=0;o<s;o++)t[o+n]=this[o+r];else t._set(this.subarray(r,r+s),n);return s},a.prototype.fill=function(t,n,r){t||(t=0),n||(n=0),r||(r=this.length);if(r<n)throw new RangeError("end < start");if(r===n)return;if(this.length===0)return;if(n<0||n>=this.length)throw new RangeError("start out of bounds");if(r<0||r>this.length)throw new RangeError("end out of bounds");var i;if(typeof t=="number")for(i=n;i<r;i++)this[i]=t;else{var s=H(t.toString()),o=s.length;for(i=n;i<r;i++)this[i]=s[i%o]}return this},a.prototype.toArrayBuffer=function(){if(typeof Uint8Array!="undefined"){if(a.TYPED_ARRAY_SUPPORT)return(new a(this)).buffer;var t=new Uint8Array(this.length);for(var n=0,r=t.length;n<r;n+=1)t[n]=this[n];return t.buffer}throw new TypeError("Buffer.toArrayBuffer not supported in this browser")};var A=a.prototype;a._augment=function(t){return t.constructor=a,t._isBuffer=!0,t._set=t.set,t.get=A.get,t.set=A.set,t.write=A.write,t.toString=A.toString,t.toLocaleString=A.toString,t.toJSON=A.toJSON,t.equals=A.equals,t.compare=A.compare,t.indexOf=A.indexOf,t.copy=A.copy,t.slice=A.slice,t.readUIntLE=A.readUIntLE,t.readUIntBE=A.readUIntBE,t.readUInt8=A.readUInt8,t.readUInt16LE=A.readUInt16LE,t.readUInt16BE=A.readUInt16BE,t.readUInt32LE=A.readUInt32LE,t.readUInt32BE=A.readUInt32BE,t.readIntLE=A.readIntLE,t.readIntBE=A.readIntBE,t.readInt8=A.readInt8,t.readInt16LE=A.readInt16LE,t.readInt16BE=A.readInt16BE,t.readInt32LE=A.readInt32LE,t.readInt32BE=A.readInt32BE,t.readFloatLE=A.readFloatLE,t.readFloatBE=A.readFloatBE,t.readDoubleLE=A.readDoubleLE,t.readDoubleBE=A.readDoubleBE,t.writeUInt8=A.writeUInt8,t.writeUIntLE=A.writeUIntLE,t.writeUIntBE=A.writeUIntBE,t.writeUInt16LE=A.writeUInt16LE,t.writeUInt16BE=A.writeUInt16BE,t.writeUInt32LE=A.writeUInt32LE,t.writeUInt32BE=A.writeUInt32BE,t.writeIntLE=A.writeIntLE,t.writeIntBE=A.writeIntBE,t.writeInt8=A.writeInt8,t.writeInt16LE=A.writeInt16LE,t.writeInt16BE=A.writeInt16BE,t.writeInt32LE=A.writeInt32LE,t.writeInt32BE=A.writeInt32BE,t.writeFloatLE=A.writeFloatLE,t.writeFloatBE=A.writeFloatBE,t.writeDoubleLE=A.writeDoubleLE,t.writeDoubleBE=A.writeDoubleBE,t.fill=A.fill,t.inspect=A.inspect,t.toArrayBuffer=A.toArrayBuffer,t};var O=/[^+\/0-9A-z\-]/g},{"base64-js":13,ieee754:14,"is-array":15}],13:[function(e,t,n){var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";(function(e){"use strict";function l(e){var t=e.charCodeAt(0);if(t===n||t===a)return 62;if(t===i||t===f)return 63;if(t<s)return-1;if(t<s+10)return t-s+26+26;if(t<u+26)return t-u;if(t<o+26)return t-o+26}function c(e){function c(e){u[f++]=e}var n,r,i,s,o,u;if(e.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var a=e.length;o="="===e.charAt(a-2)?2:"="===e.charAt(a-1)?1:0,u=new t(e.length*3/4-o),i=o>0?e.length-4:e.length;var f=0;for(n=0,r=0;n<i;n+=4,r+=3)s=l(e.charAt(n))<<18|l(e.charAt(n+1))<<12|l(e.charAt(n+2))<<6|l(e.charAt(n+3)),c((s&16711680)>>16),c((s&65280)>>8),c(s&255);return o===2?(s=l(e.charAt(n))<<2|l(e.charAt(n+1))>>4,c(s&255)):o===1&&(s=l(e.charAt(n))<<10|l(e.charAt(n+1))<<4|l(e.charAt(n+2))>>2,c(s>>8&255),c(s&255)),u}function h(e){function u(e){return r.charAt(e)}function a(e){return u(e>>18&63)+u(e>>12&63)+u(e>>6&63)+u(e&63)}var t,n=e.length%3,i="",s,o;for(t=0,o=e.length-n;t<o;t+=3)s=(e[t]<<16)+(e[t+1]<<8)+e[t+2],i+=a(s);switch(n){case 1:s=e[e.length-1],i+=u(s>>2),i+=u(s<<4&63),i+="==";break;case 2:s=(e[e.length-2]<<8)+e[e.length-1],i+=u(s>>10),i+=u(s>>4&63),i+=u(s<<2&63),i+="="}return i}var t=typeof Uint8Array!="undefined"?Uint8Array:Array,n="+".charCodeAt(0),i="/".charCodeAt(0),s="0".charCodeAt(0),o="a".charCodeAt(0),u="A".charCodeAt(0),a="-".charCodeAt(0),f="_".charCodeAt(0);e.toByteArray=c,e.fromByteArray=h})(typeof n=="undefined"?this.base64js={}:n)},{}],14:[function(e,t,n){n.read=function(e,t,n,r,i){var s,o,u=i*8-r-1,a=(1<<u)-1,f=a>>1,l=-7,c=n?i-1:0,h=n?-1:1,p=e[t+c];c+=h,s=p&(1<<-l)-1,p>>=-l,l+=u;for(;l>0;s=s*256+e[t+c],c+=h,l-=8);o=s&(1<<-l)-1,s>>=-l,l+=r;for(;l>0;o=o*256+e[t+c],c+=h,l-=8);if(s===0)s=1-f;else{if(s===a)return o?NaN:(p?-1:1)*Infinity;o+=Math.pow(2,r),s-=f}return(p?-1:1)*o*Math.pow(2,s-r)},n.write=function(e,t,n,r,i,s){var o,u,a,f=s*8-i-1,l=(1<<f)-1,c=l>>1,h=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:s-1,d=r?1:-1,v=t<0||t===0&&1/t<0?1:0;t=Math.abs(t),isNaN(t)||t===Infinity?(u=isNaN(t)?1:0,o=l):(o=Math.floor(Math.log(t)/Math.LN2),t*(a=Math.pow(2,-o))<1&&(o--,a*=2),o+c>=1?t+=h/a:t+=h*Math.pow(2,1-c),t*a>=2&&(o++,a/=2),o+c>=l?(u=0,o=l):o+c>=1?(u=(t*a-1)*Math.pow(2,i),o+=c):(u=t*Math.pow(2,c-1)*Math.pow(2,i),o=0));for(;i>=8;e[n+p]=u&255,p+=d,u/=256,i-=8);o=o<<i|u,f+=i;for(;f>0;e[n+p]=o&255,p+=d,o/=256,f-=8);e[n+p-d]|=v*128}},{}],15:[function(e,t,n){var r=Array.isArray,i=Object.prototype.toString;t.exports=r||function(e){return!!e&&"[object Array]"==i.call(e)}},{}],16:[function(e,t,n){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||undefined}function i(e){return typeof e=="function"}function s(e){return typeof e=="number"}function o(e){return typeof e=="object"&&e!==null}function u(e){return e===void 0}t.exports=r,r.EventEmitter=r,r.prototype._events=undefined,r.prototype._maxListeners=undefined,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(e){if(!s(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},r.prototype.emit=function(e){var t,n,r,s,a,f;this._events||(this._events={});if(e==="error")if(!this._events.error||o(this._events.error)&&!this._events.error.length)throw t=arguments[1],t instanceof Error?t:TypeError('Uncaught, unspecified "error" event.');n=this._events[e];if(u(n))return!1;if(i(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:r=arguments.length,s=new Array(r-1);for(a=1;a<r;a++)s[a-1]=arguments[a];n.apply(this,s)}else if(o(n)){r=arguments.length,s=new Array(r-1);for(a=1;a<r;a++)s[a-1]=arguments[a];f=n.slice(),r=f.length;for(a=0;a<r;a++)f[a].apply(this,s)}return!0},r.prototype.addListener=function(e,t){var n;if(!i(t))throw TypeError("listener must be a function");this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(t.listener)?t.listener:t),this._events[e]?o(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t;if(o(this._events[e])&&!this._events[e].warned){var n;u(this._maxListeners)?n=r.defaultMaxListeners:n=this._maxListeners,n&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),typeof console.trace=="function"&&console.trace())}return this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(e,t){function r(){this.removeListener(e,r),n||(n=!0,t.apply(this,arguments))}if(!i(t))throw TypeError("listener must be a function");var n=!1;return r.listener=t,this.on(e,r),this},r.prototype.removeListener=function(e,t){var n,r,s,u;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;n=this._events[e],s=n.length,r=-1;if(n===t||i(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(o(n)){for(u=s;u-->0;)if(n[u]===t||n[u].listener&&n[u].listener===t){r=u;break}if(r<0)return this;n.length===1?(n.length=0,delete this._events[e]):n.splice(r,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},r.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return arguments.length===0?this._events={}:this._events[e]&&delete this._events[e],this;if(arguments.length===0){for(t in this._events){if(t==="removeListener")continue;this.removeAllListeners(t)}return this.removeAllListeners("removeListener"),this._events={},this}n=this._events[e];if(i(n))this.removeListener(e,n);else while(n.length)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},r.prototype.listeners=function(e){var t;return!this._events||!this._events[e]?t=[]:i(this._events[e])?t=[this._events[e]]:t=this._events[e].slice(),t},r.listenerCount=function(e,t){var n;return!e._events||!e._events[t]?n=0:i(e._events[t])?n=1:n=e._events[t].length,n}},{}],17:[function(e,t,n){typeof Object.create=="function"?t.exports=function(t,n){t.super_=n,t.prototype=Object.create(n.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(t,n){t.super_=n;var r=function(){};r.prototype=n.prototype,t.prototype=new r,t.prototype.constructor=t}},{}],18:[function(e,t,n){t.exports=Array.isArray||function(e){return Object.prototype.toString.call(e)=="[object Array]"}},{}],19:[function(e,t,n){function o(){if(s)return;s=!0;var e,t=i.length;while(t){e=i,i=[];var n=-1;while(++n<t)e[n]();t=i.length}s=!1}function u(){}var r=t.exports={},i=[],s=!1;r.nextTick=function(e){i.push(e),s||setTimeout(o,0)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=u,r.addListener=u,r.once=u,r.off=u,r.removeListener=u,r.removeAllListeners=u,r.emit=u,r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},{}],20:[function(e,t,n){t.exports=e("./lib/_stream_duplex.js")},{"./lib/_stream_duplex.js":21}],21:[function(e,t,n){(function(n){function u(e){if(!(this instanceof u))return new u(e);s.call(this,e),o.call(this,e),e&&e.readable===!1&&(this.readable=!1),e&&e.writable===!1&&(this.writable=!1),this.allowHalfOpen=!0,e&&e.allowHalfOpen===!1&&(this.allowHalfOpen=!1),this.once("end",a)}function a(){if(this.allowHalfOpen||this._writableState.ended)return;n.nextTick(this.end.bind(this))}function f(e,t){for(var n=0,r=e.length;n<r;n++)t(e[n],n)}t.exports=u;var r=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t},i=e("core-util-is");i.inherits=e("inherits");var s=e("./_stream_readable"),o=e("./_stream_writable");i.inherits(u,s),f(r(o.prototype),function(e){u.prototype[e]||(u.prototype[e]=o.prototype[e])})}).call(this,e("_process"))},{"./_stream_readable":23,"./_stream_writable":25,_process:19,"core-util-is":26,inherits:17}],22:[function(e,t,n){function s(e){if(!(this instanceof s))return new s(e);r.call(this,e)}t.exports=s;var r=e("./_stream_transform"),i=e("core-util-is");i.inherits=e("inherits"),i.inherits(s,r),s.prototype._transform=function(e,t,n){n(null,e)}},{"./_stream_transform":24,"core-util-is":26,inherits:17}],23:[function(e,t,n){(function(n){function l(t,n){var r=e("./_stream_duplex");t=t||{};var i=t.highWaterMark,s=t.objectMode?16:16384;this.highWaterMark=i||i===0?i:s,this.highWaterMark=~~this.highWaterMark,this.buffer=[],this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.objectMode=!!t.objectMode,n instanceof r&&(this.objectMode=this.objectMode||!!t.readableObjectMode),this.defaultEncoding=t.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(a||(a=e("string_decoder/").StringDecoder),this.decoder=new a(t.encoding),this.encoding=t.encoding)}function c(t){var n=e("./_stream_duplex");if(!(this instanceof c))return new c(t);this._readableState=new l(t,this),this.readable=!0,o.call(this)}function h(e,t,n,r,i){var s=g(t,n);if(s)e.emit("error",s);else if(u.isNullOrUndefined(n))t.reading=!1,t.ended||y(e,t);else if(t.objectMode||n&&n.length>0)if(t.ended&&!i){var o=new Error("stream.push() after EOF");e.emit("error",o)}else if(t.endEmitted&&i){var o=new Error("stream.unshift() after end event");e.emit("error",o)}else t.decoder&&!i&&!r&&(n=t.decoder.write(n)),i||(t.reading=!1),t.flowing&&t.length===0&&!t.sync?(e.emit("data",n),e.read(0)):(t.length+=t.objectMode?1:n.length,i?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&b(e)),E(e,t);else i||(t.reading=!1);return p(t)}function p(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||e.length===0)}function v(e){if(e>=d)e=d;else{e--;for(var t=1;t<32;t<<=1)e|=e>>t;e++}return e}function m(e,t){return t.length===0&&t.ended?0:t.objectMode?e===0?0:1:isNaN(e)||u.isNull(e)?t.flowing&&t.buffer.length?t.buffer[0].length:t.length:e<=0?0:(e>t.highWaterMark&&(t.highWaterMark=v(e)),e>t.length?t.ended?t.length:(t.needReadable=!0,0):e)}function g(e,t){var n=null;return!u.isBuffer(t)&&!u.isString(t)&&!u.isNullOrUndefined(t)&&!e.objectMode&&(n=new TypeError("Invalid non-string/buffer chunk")),n}function y(e,t){if(t.decoder&&!t.ended){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,b(e)}function b(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(f("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?n.nextTick(function(){w(e)}):w(e))}function w(e){f("emit readable"),e.emit("readable"),C(e)}function E(e,t){t.readingMore||(t.readingMore=!0,n.nextTick(function(){S(e,t)}))}function S(e,t){var n=t.length;while(!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark){f("maybeReadMore read 0"),e.read(0);if(n===t.length)break;n=t.length}t.readingMore=!1}function x(e){return function(){var t=e._readableState;f("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,t.awaitDrain===0&&s.listenerCount(e,"data")&&(t.flowing=!0,C(e))}}function T(e,t){t.resumeScheduled||(t.resumeScheduled=!0,n.nextTick(function(){N(e,t)}))}function N(e,t){t.resumeScheduled=!1,e.emit("resume"),C(e),t.flowing&&!t.reading&&e.read(0)}function C(e){var t=e._readableState;f("flow",t.flowing);if(t.flowing)do var n=e.read();while(null!==n&&t.flowing)}function k(e,t){var n=t.buffer,r=t.length,s=!!t.decoder,o=!!t.objectMode,u;if(n.length===0)return null;if(r===0)u=null;else if(o)u=n.shift();else if(!e||e>=r)s?u=n.join(""):u=i.concat(n,r),n.length=0;else if(e<n[0].length){var a=n[0];u=a.slice(0,e),n[0]=a.slice(e)}else if(e===n[0].length)u=n.shift();else{s?u="":u=new i(e);var f=0;for(var l=0,c=n.length;l<c&&f<e;l++){var a=n[0],h=Math.min(e-f,a.length);s?u+=a.slice(0,h):a.copy(u,f,0,h),h<a.length?n[0]=a.slice(h):n.shift(),f+=h}}return u}function L(e){var t=e._readableState;if(t.length>0)throw new Error("endReadable called on non-empty stream");t.endEmitted||(t.ended=!0,n.nextTick(function(){!t.endEmitted&&t.length===0&&(t.endEmitted=!0,e.readable=!1,e.emit("end"))}))}function A(e,t){for(var n=0,r=e.length;n<r;n++)t(e[n],n)}function O(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}t.exports=c;var r=e("isarray"),i=e("buffer").Buffer;c.ReadableState=l;var s=e("events").EventEmitter;s.listenerCount||(s.listenerCount=function(e,t){return e.listeners(t).length});var o=e("stream"),u=e("core-util-is");u.inherits=e("inherits");var a,f=e("util");f&&f.debuglog?f=f.debuglog("stream"):f=function(){},u.inherits(c,o),c.prototype.push=function(e,t){var n=this._readableState;return u.isString(e)&&!n.objectMode&&(t=t||n.defaultEncoding,t!==n.encoding&&(e=new i(e,t),t="")),h(this,n,e,t,!1)},c.prototype.unshift=function(e){var t=this._readableState;return h(this,t,e,"",!0)},c.prototype.setEncoding=function(t){return a||(a=e("string_decoder/").StringDecoder),this._readableState.decoder=new a(t),this._readableState.encoding=t,this};var d=8388608;c.prototype.read=function(e){f("read",e);var t=this._readableState,n=e;if(!u.isNumber(e)||e>0)t.emittedReadable=!1;if(e===0&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return f("read: emitReadable",t.length,t.ended),t.length===0&&t.ended?L(this):b(this),null;e=m(e,t);if(e===0&&t.ended)return t.length===0&&L(this),null;var r=t.needReadable;f("need readable",r);if(t.length===0||t.length-e<t.highWaterMark)r=!0,f("length less than watermark",r);if(t.ended||t.reading)r=!1,f("reading or ended",r);r&&(f("do read"),t.reading=!0,t.sync=!0,t.length===0&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1),r&&!t.reading&&(e=m(n,t));var i;return e>0?i=k(e,t):i=null,u.isNull(i)&&(t.needReadable=!0,e=0),t.length-=e,t.length===0&&!t.ended&&(t.needReadable=!0),n!==e&&t.ended&&t.length===0&&L(this),u.isNull(i)||this.emit("data",i),i},c.prototype._read=function(e){this.emit("error",new Error("not implemented"))},c.prototype.pipe=function(e,t){function l(e){f("onunpipe"),e===i&&p()}function c(){f("onend"),e.end()}function p(){f("cleanup"),e.removeListener("close",m),e.removeListener("finish",g),e.removeListener("drain",h),e.removeListener("error",v),e.removeListener("unpipe",l),i.removeListener("end",c),i.removeListener("end",p),i.removeListener("data",d),o.awaitDrain&&(!e._writableState||e._writableState.needDrain)&&h()}function d(t){f("ondata");var n=e.write(t);!1===n&&(f("false write response, pause",i._readableState.awaitDrain),i._readableState.awaitDrain++,i.pause())}function v(t){f("onerror",t),y(),e.removeListener("error",v),s.listenerCount(e,"error")===0&&e.emit("error",t)}function m(){e.removeListener("finish",g),y()}function g(){f("onfinish"),e.removeListener("close",m),y()}function y(){f("unpipe"),i.unpipe(e)}var i=this,o=this._readableState;switch(o.pipesCount){case 0:o.pipes=e;break;case 1:o.pipes=[o.pipes,e];break;default:o.pipes.push(e)}o.pipesCount+=1,f("pipe count=%d opts=%j",o.pipesCount,t);var u=(!t||t.end!==!1)&&e!==n.stdout&&e!==n.stderr,a=u?c:p;o.endEmitted?n.nextTick(a):i.once("end",a),e.on("unpipe",l);var h=x(i);return e.on("drain",h),i.on("data",d),!e._events||!e._events.error?e.on("error",v):r(e._events.error)?e._events.error.unshift(v):e._events.error=[v,e._events.error],e.once("close",m),e.once("finish",g),e.emit("pipe",i),o.flowing||(f("pipe resume"),i.resume()),e},c.prototype.unpipe=function(e){var t=this._readableState;if(t.pipesCount===0)return this;if(t.pipesCount===1)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this),this);if(!e){var n=t.pipes,r=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var i=0;i<r;i++)n[i].emit("unpipe",this);return this}var i=O(t.pipes,e);return i===-1?this:(t.pipes.splice(i,1),t.pipesCount-=1,t.pipesCount===1&&(t.pipes=t.pipes[0]),e.emit("unpipe",this),this)},c.prototype.on=function(e,t){var r=o.prototype.on.call(this,e,t);e==="data"&&!1!==this._readableState.flowing&&this.resume();if(e==="readable"&&this.readable){var i=this._readableState;if(!i.readableListening){i.readableListening=!0,i.emittedReadable=!1,i.needReadable=!0;if(!i.reading){var s=this;n.nextTick(function(){f("readable nexttick read 0"),s.read(0)})}else i.length&&b(this,i)}}return r},c.prototype.addListener=c.prototype.on,c.prototype.resume=function(){var e=this._readableState;return e.flowing||(f("resume"),e.flowing=!0,e.reading||(f("resume read 0"),this.read(0)),T(this,e)),this},c.prototype.pause=function(){return f("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(f("pause"),this._readableState.flowing=!1,this.emit("pause")),this},c.prototype.wrap=function(e){var t=this._readableState,n=!1,r=this;e.on("end",function(){f("wrapped end");if(t.decoder&&!t.ended){var e=t.decoder.end();e&&e.length&&r.push(e)}r.push(null)}),e.on("data",function(i){f("wrapped data"),t.decoder&&(i=t.decoder.write(i));if(!i||!t.objectMode&&!i.length)return;var s=r.push(i);s||(n=!0,e.pause())});for(var i in e)u.isFunction(e[i])&&u.isUndefined(this[i])&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));var s=["error","close","destroy","pause","resume"];return A(s,function(t){e.on(t,r.emit.bind(r,t))}),r._read=function(t){f("wrapped _read",t),n&&(n=!1,e.resume())},r},c._fromList=k}).call(this,e("_process"))},{"./_stream_duplex":21,_process:19,buffer:12,"core-util-is":26,events:16,inherits:17,isarray:18,stream:31,"string_decoder/":32,util:11}],24:[function(e,t,n){function s(e,t){this.afterTransform=function(e,n){return o(t,e,n)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null}function o(e,t,n){var r=e._transformState;r.transforming=!1;var s=r.writecb;if(!s)return e.emit("error",new Error("no writecb in Transform class"));r.writechunk=null,r.writecb=null,i.isNullOrUndefined(n)||e.push(n),s&&s(t);var o=e._readableState;o.reading=!1,(o.needReadable||o.length<o.highWaterMark)&&e._read(o.highWaterMark)}function u(e){if(!(this instanceof u))return new u(e);r.call(this,e),this._transformState=new s(e,this);var t=this;this._readableState.needReadable=!0,this._readableState.sync=!1,this.once("prefinish",function(){i.isFunction(this._flush)?this._flush(function(e){a(t,e)}):a(t)})}function a(e,t){if(t)return e.emit("error",t);var n=e._writableState,r=e._transformState;if(n.length)throw new Error("calling transform done when ws.length != 0");if(r.transforming)throw new Error("calling transform done when still transforming");return e.push(null)}t.exports=u;var r=e("./_stream_duplex"),i=e("core-util-is");i.inherits=e("inherits"),i.inherits(u,r),u.prototype.push=function(e,t){return this._transformState.needTransform=!1,r.prototype.push.call(this,e,t)},u.prototype._transform=function(e,t,n){throw new Error("not implemented")},u.prototype._write=function(e,t,n){var r=this._transformState;r.writecb=n,r.writechunk=e,r.writeencoding=t;if(!r.transforming){var i=this._readableState;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},u.prototype._read=function(e){var t=this._transformState;!i.isNull(t.writechunk)&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0}},{"./_stream_duplex":21,"core-util-is":26,inherits:17}],25:[function(e,t,n){(function(n){function o(e,t,n){this.chunk=e,this.encoding=t,this.callback=n}function u(t,n){var r=e("./_stream_duplex");t=t||{};var i=t.highWaterMark,s=t.objectMode?16:16384;this.highWaterMark=i||i===0?i:s,this.objectMode=!!t.objectMode,n instanceof r&&(this.objectMode=this.objectMode||!!t.writableObjectMode),this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var o=t.decodeStrings===!1;this.decodeStrings=!o,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){m(n,e)},this.writecb=null,this.writelen=0,this.buffer=[],this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1}function a(t){var n=e("./_stream_duplex");if(!(this instanceof a||this instanceof n))return new a(t);this._writableState=new u(t,this),this.writable=!0,s.call(this)}function f(e,t,r){var i=new Error("write after end");e.emit("error",i),n.nextTick(function(){r(i)})}function l(e,t,r,s){var o=!0;if(!i.isBuffer(r)&&!i.isString(r)&&!i.isNullOrUndefined(r)&&!t.objectMode){var u=new TypeError("Invalid non-string/buffer chunk");e.emit("error",u),n.nextTick(function(){s(u)}),o=!1}return o}function c(e,t,n){return!e.objectMode&&e.decodeStrings!==!1&&i.isString(t)&&(t=new r(t,n)),t}function h(e,t,n,r,s){n=c(t,n,r),i.isBuffer(n)&&(r="buffer");var u=t.objectMode?1:n.length;t.length+=u;var a=t.length<t.highWaterMark;return a||(t.needDrain=!0),t.writing||t.corked?t.buffer.push(new o(n,r,s)):p(e,t,!1,u,n,r,s),a}function p(e,t,n,r,i,s,o){t.writelen=r,t.writecb=o,t.writing=!0,t.sync=!0,n?e._writev(i,t.onwrite):e._write(i,s,t.onwrite),t.sync=!1}function d(e,t,r,i,s){r?n.nextTick(function(){t.pendingcb--,s(i)}):(t.pendingcb--,s(i)),e._writableState.errorEmitted=!0,e.emit("error",i)}function v(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}function m(e,t){var r=e._writableState,i=r.sync,s=r.writecb;v(r);if(t)d(e,r,i,t,s);else{var o=w(e,r);!o&&!r.corked&&!r.bufferProcessing&&r.buffer.length&&b(e,r),i?n.nextTick(function(){g(e,r,o,s)}):g(e,r,o,s)}}function g(e,t,n,r){n||y(e,t),t.pendingcb--,r(),S(e,t)}function y(e,t){t.length===0&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}function b(e,t){t.bufferProcessing=!0;if(e._writev&&t.buffer.length>1){var n=[];for(var r=0;r<t.buffer.length;r++)n.push(t.buffer[r].callback);t.pendingcb++,p(e,t,!0,t.length,t.buffer,"",function(e){for(var r=0;r<n.length;r++)t.pendingcb--,n[r](e)}),t.buffer=[]}else{for(var r=0;r<t.buffer.length;r++){var i=t.buffer[r],s=i.chunk,o=i.encoding,u=i.callback,a=t.objectMode?1:s.length;p(e,t,!1,a,s,o,u);if(t.writing){r++;break}}r<t.buffer.length?t.buffer=t.buffer.slice(r):t.buffer.length=0}t.bufferProcessing=!1}function w(e,t){return t.ending&&t.length===0&&!t.finished&&!t.writing}function E(e,t){t.prefinished||(t.prefinished=!0,e.emit("prefinish"))}function S(e,t){var n=w(e,t);return n&&(t.pendingcb===0?(E(e,t),t.finished=!0,e.emit("finish")):E(e,t)),n}function x(e,t,r){t.ending=!0,S(e,t),r&&(t.finished?n.nextTick(r):e.once("finish",r)),t.ended=!0}t.exports=a;var r=e("buffer").Buffer;a.WritableState=u;var i=e("core-util-is");i.inherits=e("inherits");var s=e("stream");i.inherits(a,s),a.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe. Not readable."))},a.prototype.write=function(e,t,n){var r=this._writableState,s=!1;return i.isFunction(t)&&(n=t,t=null),i.isBuffer(e)?t="buffer":t||(t=r.defaultEncoding),i.isFunction(n)||(n=function(){}),r.ended?f(this,r,n):l(this,r,e,n)&&(r.pendingcb++,s=h(this,r,e,t,n)),s},a.prototype.cork=function(){var e=this._writableState;e.corked++},a.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,!e.writing&&!e.corked&&!e.finished&&!e.bufferProcessing&&e.buffer.length&&b(this,e))},a.prototype._write=function(e,t,n){n(new Error("not implemented"))},a.prototype._writev=null,a.prototype.end=function(e,t,n){var r=this._writableState;i.isFunction(e)?(n=e,e=null,t=null):i.isFunction(t)&&(n=t,t=null),i.isNullOrUndefined(e)||this.write(e,t),r.corked&&(r.corked=1,this.uncork()),!r.ending&&!r.finished&&x(this,r,n)}}).call(this,e("_process"))},{"./_stream_duplex":21,_process:19,buffer:12,"core-util-is":26,inherits:17,stream:31}],26:[function(e,t,n){(function(e){function t(e){return Array.isArray(e)}function r(e){return typeof e=="boolean"}function i(e){return e===null}function s(e){return e==null}function o(e){return typeof e=="number"}function u(e){return typeof e=="string"}function a(e){return typeof e=="symbol"}function f(e){return e===void 0}function l(e){return c(e)&&g(e)==="[object RegExp]"}function c(e){return typeof e=="object"&&e!==null}function h(e){return c(e)&&g(e)==="[object Date]"}function p(e){return c(e)&&(g(e)==="[object Error]"||e instanceof Error)}function d(e){return typeof e=="function"}function v(e){return e===null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||typeof e=="symbol"||typeof e=="undefined"}function m(t){return e.isBuffer(t)}function g(e){return Object.prototype.toString.call(e)}n.isArray=t,n.isBoolean=r,n.isNull=i,n.isNullOrUndefined=s,n.isNumber=o,n.isString=u,n.isSymbol=a,n.isUndefined=f,n.isRegExp=l,n.isObject=c,n.isDate=h,n.isError=p,n.isFunction=d,n.isPrimitive=v,n.isBuffer=m}).call(this,e("buffer").Buffer)},{buffer:12}],27:[function(e,t,n){t.exports=e("./lib/_stream_passthrough.js")},{"./lib/_stream_passthrough.js":22}],28:[function(e,t,n){n=t.exports=e("./lib/_stream_readable.js"),n.Stream=e("stream"),n.Readable=n,n.Writable=e("./lib/_stream_writable.js"),n.Duplex=e("./lib/_stream_duplex.js"),n.Transform=e("./lib/_stream_transform.js"),n.PassThrough=e("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":21,"./lib/_stream_passthrough.js":22,"./lib/_stream_readable.js":23,"./lib/_stream_transform.js":24,"./lib/_stream_writable.js":25,stream:31}],29:[function(e,t,n){t.exports=e("./lib/_stream_transform.js")},{"./lib/_stream_transform.js":24}],30:[function(e,t,n){t.exports=e("./lib/_stream_writable.js")},{"./lib/_stream_writable.js":25}],31:[function(e,t,n){function s(){r.call(this)}t.exports=s;var r=e("events").EventEmitter,i=e("inherits");i(s,r),s.Readable=e("readable-stream/readable.js"),s.Writable=e("readable-stream/writable.js"),s.Duplex=e("readable-stream/duplex.js"),s.Transform=e("readable-stream/transform.js"),s.PassThrough=e("readable-stream/passthrough.js"),s.Stream=s,s.prototype.pipe=function(e,t){function i(t){e.writable&&!1===e.write(t)&&n.pause&&n.pause()}function s(){n.readable&&n.resume&&n.resume()}function u(){if(o)return;o=!0,e.end()}function a(){if(o)return;o=!0,typeof e.destroy=="function"&&e.destroy()}function f(e){l();if(r.listenerCount(this,"error")===0)throw e}function l(){n.removeListener("data",i),e.removeListener("drain",s),n.removeListener("end",u),n.removeListener("close",a),n.removeListener("error",f),e.removeListener("error",f),n.removeListener("end",l),n.removeListener("close",l),e.removeListener("close",l)}var n=this;n.on("data",i),e.on("drain",s),!e._isStdio&&(!t||t.end!==!1)&&(n.on("end",u),n.on("close",a));var o=!1;return n.on("error",f),e.on("error",f),n.on("end",l),n.on("close",l),e.on("close",l),e.emit("pipe",n),e}},{events:16,inherits:17,"readable-stream/duplex.js":20,"readable-stream/passthrough.js":27,"readable-stream/readable.js":28,"readable-stream/transform.js":29,"readable-stream/writable.js":30}],32:[function(e,t,n){function s(e){if(e&&!i(e))throw new Error("Unknown encoding: "+e)}function u(e){return e.toString(this.encoding)}function a(e){this.charReceived=e.length%2,this.charLength=this.charReceived?2:0}function f(e){this.charReceived=e.length%3,this.charLength=this.charReceived?3:0}var r=e("buffer").Buffer,i=r.isEncoding||function(e){switch(e&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}},o=n.StringDecoder=function(e){this.encoding=(e||"utf8").toLowerCase().replace(/[-_]/,""),s(e);switch(this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=a;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=f;break;default:this.write=u;return}this.charBuffer=new r(6),this.charReceived=0,this.charLength=0};o.prototype.write=function(e){var t="";while(this.charLength){var n=e.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:e.length;e.copy(this.charBuffer,this.charReceived,0,n),this.charReceived+=n;if(this.charReceived<this.charLength)return"";e=e.slice(n,e.length),t=this.charBuffer.slice(0,this.charLength).toString(this.encoding);var r=t.charCodeAt(t.length-1);if(r>=55296&&r<=56319){this.charLength+=this.surrogateSize,t="";continue}this.charReceived=this.charLength=0;if(e.length===0)return t;break}this.detectIncompleteChar(e);var i=e.length;this.charLength&&(e.copy(this.charBuffer,0,e.length-this.charReceived,i),i-=this.charReceived),t+=e.toString(this.encoding,0,i);var i=t.length-1,r=t.charCodeAt(i);if(r>=55296&&r<=56319){var s=this.surrogateSize;return this.charLength+=s,this.charReceived+=s,this.charBuffer.copy(this.charBuffer,s,0,s),e.copy(this.charBuffer,0,0,s),t.substring(0,i)}return t},o.prototype.detectIncompleteChar=function(e){var t=e.length>=3?3:e.length;for(;t>0;t--){var n=e[e.length-t];if(t==1&&n>>5==6){this.charLength=2;break}if(t<=2&&n>>4==14){this.charLength=3;break}if(t<=3&&n>>3==30){this.charLength=4;break}}this.charReceived=t},o.prototype.end=function(e){var t="";e&&e.length&&(t=this.write(e));if(this.charReceived){var n=this.charReceived,r=this.charBuffer,i=this.encoding;t+=r.slice(0,n).toString(i)}return t}},{buffer:12}],33:[function(e,t,n){t.exports=function(t){return t&&typeof t=="object"&&typeof t.copy=="function"&&typeof t.fill=="function"&&typeof t.readUInt8=="function"}},{}],34:[function(e,t,n){(function(t,r){function u(e,t){var r={seen:[],stylize:f};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),y(t)?r.showHidden=t:t&&n._extend(r,t),T(r.showHidden)&&(r.showHidden=!1),T(r.depth)&&(r.depth=2),T(r.colors)&&(r.colors=!1),T(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=a),c(r,e,r.depth)}function a(e,t){var n=u.styles[t];return n?"["+u.colors[n][0]+"m"+e+"["+u.colors[n][1]+"m":e}function f(e,t){return e}function l(e){var t={};return e.forEach(function(e,n){t[e]=!0}),t}function c(e,t,r){if(e.customInspect&&t&&A(t.inspect)&&t.inspect!==n.inspect&&(!t.constructor||t.constructor.prototype!==t)){var i=t.inspect(r,e);return S(i)||(i=c(e,i,r)),i}var s=h(e,t);if(s)return s;var o=Object.keys(t),u=l(o);e.showHidden&&(o=Object.getOwnPropertyNames(t));if(L(t)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return p(t);if(o.length===0){if(A(t)){var a=t.name?": "+t.name:"";return e.stylize("[Function"+a+"]","special")}if(N(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(k(t))return e.stylize(Date.prototype.toString.call(t),"date");if(L(t))return p(t)}var f="",y=!1,b=["{","}"];g(t)&&(y=!0,b=["[","]"]);if(A(t)){var w=t.name?": "+t.name:"";f=" [Function"+w+"]"}N(t)&&(f=" "+RegExp.prototype.toString.call(t)),k(t)&&(f=" "+Date.prototype.toUTCString.call(t)),L(t)&&(f=" "+p(t));if(o.length!==0||!!y&&t.length!=0){if(r<0)return N(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special");e.seen.push(t);var E;return y?E=d(e,t,r,u,o):E=o.map(function(n){return v(e,t,r,u,n,y)}),e.seen.pop(),m(E,f,b)}return b[0]+f+b[1]}function h(e,t){if(T(t))return e.stylize("undefined","undefined");if(S(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}if(E(t))return e.stylize(""+t,"number");if(y(t))return e.stylize(""+t,"boolean");if(b(t))return e.stylize("null","null")}function p(e){return"["+Error.prototype.toString.call(e)+"]"}function d(e,t,n,r,i){var s=[];for(var o=0,u=t.length;o<u;++o)H(t,String(o))?s.push(v(e,t,n,r,String(o),!0)):s.push("");return i.forEach(function(i){i.match(/^\d+$/)||s.push(v(e,t,n,r,i,!0))}),s}function v(e,t,n,r,i,s){var o,u,a;a=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]},a.get?a.set?u=e.stylize("[Getter/Setter]","special"):u=e.stylize("[Getter]","special"):a.set&&(u=e.stylize("[Setter]","special")),H(r,i)||(o="["+i+"]"),u||(e.seen.indexOf(a.value)<0?(b(n)?u=c(e,a.value,null):u=c(e,a.value,n-1),u.indexOf("\n")>-1&&(s?u=u.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):u="\n"+u.split("\n").map(function(e){return"   "+e}).join("\n"))):u=e.stylize("[Circular]","special"));if(T(o)){if(s&&i.match(/^\d+$/))return u;o=JSON.stringify(""+i),o.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=e.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=e.stylize(o,"string"))}return o+": "+u}function m(e,t,n){var r=0,i=e.reduce(function(e,t){return r++,t.indexOf("\n")>=0&&r++,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0);return i>60?n[0]+(t===""?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+t+" "+e.join(", ")+" "+n[1]}function g(e){return Array.isArray(e)}function y(e){return typeof e=="boolean"}function b(e){return e===null}function w(e){return e==null}function E(e){return typeof e=="number"}function S(e){return typeof e=="string"}function x(e){return typeof e=="symbol"}function T(e){return e===void 0}function N(e){return C(e)&&M(e)==="[object RegExp]"}function C(e){return typeof e=="object"&&e!==null}function k(e){return C(e)&&M(e)==="[object Date]"}function L(e){return C(e)&&(M(e)==="[object Error]"||e instanceof Error)}function A(e){return typeof e=="function"}function O(e){return e===null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||typeof e=="symbol"||typeof e=="undefined"}function M(e){return Object.prototype.toString.call(e)}function _(e){return e<10?"0"+e.toString(10):e.toString(10)}function P(){var e=new Date,t=[_(e.getHours()),_(e.getMinutes()),_(e.getSeconds())].join(":");return[e.getDate(),D[e.getMonth()],t].join(" ")}function H(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var i=/%[sdj%]/g;n.format=function(e){if(!S(e)){var t=[];for(var n=0;n<arguments.length;n++)t.push(u(arguments[n]));return t.join(" ")}var n=1,r=arguments,s=r.length,o=String(e).replace(i,function(e){if(e==="%%")return"%";if(n>=s)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(t){return"[Circular]"};default:return e}});for(var a=r[n];n<s;a=r[++n])b(a)||!C(a)?o+=" "+a:o+=" "+u(a);return o},n.deprecate=function(e,i){function o(){if(!s){if(t.throwDeprecation)throw new Error(i);t.traceDeprecation?console.trace(i):console.error(i),s=!0}return e.apply(this,arguments)}if(T(r.process))return function(){return n.deprecate(e,i).apply(this,arguments)};if(t.noDeprecation===!0)return e;var s=!1;return o};var s={},o;n.debuglog=function(e){T(o)&&(o=t.env.NODE_DEBUG||""),e=e.toUpperCase();if(!s[e])if((new RegExp("\\b"+e+"\\b","i")).test(o)){var r=t.pid;s[e]=function(){var t=n.format.apply(n,arguments);console.error("%s %d: %s",e,r,t)}}else s[e]=function(){};return s[e]},n.inspect=u,u.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},u.styles={special:"cyan",number:"yellow","boolean":"yellow","undefined":"grey","null":"bold",string:"green",date:"magenta",regexp:"red"},n.isArray=g,n.isBoolean=y,n.isNull=b,n.isNullOrUndefined=w,n.isNumber=E,n.isString=S,n.isSymbol=x,n.isUndefined=T,n.isRegExp=N,n.isObject=C,n.isDate=k,n.isError=L,n.isFunction=A,n.isPrimitive=O,n.isBuffer=e("./support/isBuffer");var D=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];n.log=function(){console.log("%s - %s",P(),n.format.apply(n,arguments))},n.inherits=e("inherits"),n._extend=function(e,t){if(!t||!C(t))return e;var n=Object.keys(t),r=n.length;while(r--)e[n[r]]=t[n[r]];return e}}).call(this,e("_process"),typeof global!="undefined"?global:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"./support/isBuffer":33,_process:19,inherits:17}]},{},[4])(4)}),define("sharedSocket",["jquery","socketio","socketio-stream"],function(e,t,n){var r=null,i=function(e){return r?r:(r=s(e),r)},s=function(e){var n=e.path||"",r=e.url||"/",i=t(r,{path:n});return i.on("connect",function(){console.log("Client socket connected to ",n)}),i.on("disconnect",function(){console.log("Client socket disconnected from",n)}),i};return{getSocket:i,_initializeSocket:s,ioStream:n}}),define("recognizer",["jquery","sharedAudio","sharedSocket","utils"],function(e,t,n,r){console.log("> Loading recognizer.js");try{var i=i||webkitSpeechRecognition;console.log("Got recognition")}catch(s){var o=Object;console.log("Error getting recognition:",s);return}var u=function(t,n){if(!(this instanceof u))return new u(t,n);console.log("Creating new Recognizer on element",t),n=n||{},this.settings=e.extend({},u.DEFAULTS,n),this.element=e(t),this.$this=e(this);var r=this;this.listening=!1,this._setupRecognition(),this.element.click(function(){r.toggle.call(r)})};return u.DEFAULTS={continuous:!0},u.SpeechRecognition=i,u.prototype._setupRecognition=function(){this.recognition=new u.SpeechRecognition,this.recognition.continuous=this.settings.continuous;var e=this;this.recognition.onresult=function(t){e.$this.trigger("result.spoke.recognizer",t);for(var n=t.resultIndex;n<t.results.length;++n)if(t.results[n].isFinal){var r=t.results[n][0].transcript.trim();console.log("Text result:",r),e.$this.trigger("finalResult.spoke.recognizer",[r])}},this.recognition.onend=function(){console.log("Recognition ended."),e.listening=!1,e.$this.trigger("stop.spoke.recognizer")}},u.prototype._startRecognition=function(){this.listening=!0,this.recognition.start(),this.$this.trigger("start.spoke.recognizer")},u.prototype._stopRecognition=function(){this.recognition.stop()},u.prototype.toggle=function(){console.log("toggleRecognition"),this.listening?this._stopRecognition():this._startRecognition()},u.prototype.on=function(e,t){return this.$this.on(e,t)},{Recognizer:u}}),define("recorder",["jquery","sharedAudio","utils","sharedSocket"],function(e,t,n,r){console.log("> Loading recorder.js");var i=t.audioContext,s=r.ioStream,o=function(t,n){if(!(this instanceof o))return new o(t,n);console.log("Creating new Recorder on element",t),n=n||{},this.settings=e.extend({},o.DEFAULTS,n),this.recordBtn=e(t),this.socket=r.getSocket(this.settings.socketPath),this.$this=e(this),this.recording=!1,this.binaryAudioStream=null,this.audioMetadata=this.settings.audioMetadata,this.audioMetadata.sampleRate=i.sampleRate,console.log("Recorder AudioMetaData:",this.audioMetadata),this._setupAudioNodes();var s=this;this.recordBtn.click(function(){s.toggle.call(s)}),this.socket.on("audioStreamResult",function(e){console.log("Recorder firing audio stream result for",e),s.$this.trigger("result.spoke.recorder",[e])})};return o.DEFAULTS={bufferLength:2048,bufferConversion:n.convertFloat32ToInt16,socketioEvents:{emitAudioStream:"audioStream"},socketPath:"",audioMetadata:{}},o.ioStream=s,o.prototype._setupAudioNodes=function(){var e=this;this.scriptRecorderNode=i.createScriptProcessor(this.settings.bufferLength,1,1),this.scriptRecorderNode.onaudioprocess=function(n){e._recorderProcess.call(e,n)}},o.prototype._setupStream=function(e){console.log("Setting up new stream"),this.binaryAudioStream=s.createStream();var t=this.settings.socketioEvents.emitAudioStream;s(this.socket).emit(t,this.binaryAudioStream,this.audioMetadata)},o.prototype._recorderProcess=function(e){var t=e.inputBuffer.getChannelData(0),n=this.settings.bufferConversion(t);this.binaryAudioStream.writeAudio(n)},o.prototype.startRecording=function(){this.recording=!0,console.log(this.$this,this.$this.trigger),this.$this.trigger("start.spoke.recorder"),this.scriptRecorderNode.connect(i.destination),console.log("Setting up recorder.");var e=this;t.audioStreamPromise.then(function(t){console.log("Then got audioStreamSource for recorder"),t.connect(e.scriptRecorderNode),console.log("Recorder started")}).catch(function(t){console.log("Audio streaming error in recorder:",t),e.stop()})},o.prototype.stopRecording=function(){this.scriptRecorderNode.disconnect(),this.binaryAudioStream.end(),this.binaryAudioStream=null,this.recording=!1,this.$this.trigger("stop.spoke.recorder")},o.prototype.toggle=function(){this.recording?(console.log("Disconnecting recorder"),this.stopRecording()):(console.log("Starting recorder"),this._setupStream(),this.startRecording())},o.prototype.on=function(e,t,n){return this.$this.on(e,t,n)},o}),require.config({paths:{jquery:["https://code.jquery.com/jquery-1.11.0.min","third-party/jquery-1.11.0.min"],ractive:["https://cdnjs.cloudflare.com/ajax/libs/ractive/0.7.2/ractive.min","third-party/ractive-0.7.2.min"],modernizr:["https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min","third-party/modernizr.custom.68208"],socketio:["https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.5/socket.io.min","third-party/socketio-1.3.5.min"],"socketio-stream":"third-party/socket.io-stream",promise:["https://cdn.jsdelivr.net/bluebird/latest/bluebird.min","third-party/bluebird-2.9.24.min"]},shim:{modernizr:{exports:"Modernizr"}}}),define("spoke",["crossBrowserAudio","microphone","player","recognizer","recorder","sharedAudio","sharedSocket","utils"],function(e,t,n,r,i,s,o,u){return console.log("> Loaded",arguments.length,"Spoke modules."),{crossBrowserAudio:e,microphone:t,Player:n,recognizer:r,Recorder:i,sharedAudio:s,sharedSocket:o,utils:u}});